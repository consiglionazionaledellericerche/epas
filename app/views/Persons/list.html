#{extends 'main3.html' /}
#{set header:'navbar' /}
#{set title: 'ePAS - Dati del personale'  /}

#{set 'moreStyles'}
<style>
  td.alignLeft { text-align: left !important; }
</style>
#{/set}

#{secure.checkAction 'Administration.switchUserTo'}
  #{set switchUser:true /}
#{/secure.checkAction}

<div class="container">
  #{title title:'Lista Del Personale' /}

  #{tabs}
  #{tabItem id:'attivo', title:'Personale Attivo', active:true /}
  #{tabItem id:'nonAttivo', title:'Personale Non Attivo' /}
  #{/tabs}

  #{tabContent}

  #{tabContentItem id:'attivo', active:true}
  <p>
  <div class="text-center">
    <a class="btn btn-success" href="@{Persons.insertPerson}"><i class="fa fa-user-plus"></i>
      Inserisci una nuova persona </a>
  </div>
  </p>
  <table class="table table-striped table-hover table-condensed center" datatable>
    <thead>
    <tr>
      <th>&{'person.name'}</th>
      <th>&{'person.number'}</th>
      <th>&{'contract.beginDate'}</th>
      <th>&{'contract.endDate'}</th>
      <th>&{'person.currentWorkingTimeType'}</th>
      <th>&{'person.currentVacationPeriod'}</th>
      <th>&{'person.qualification'}</th>
      <th>&{'office'}</th>
      <th>&{'person.wantEmail'}</th>
      #{if switchUser}
      <th></th>
      #{/if}
    </tr>
    </thead>
    <tbody>
    #{list items:personList, as:'person'}

    #{if person.currentContract.present}
    <tr>
      <td class="alignLeft success">
        <a href="@{edit(person.value.id)}"><font color="#0000FF">${person.value.fullname}</font></a>
        
        #{if person.currentContractInitializationMissing()}
          <a href="#" popover-hover
            data-html="true"
            data-content="${('Il contratto attuale non è correttamente inizializzato.').escape()}"
            *{ title="Configurazione ${person.value.fullname}" }*><i class="fa fa-exclamation-triangle text-danger"></i></a>
        #{/if}
        #{elseif person.currentContractMonthRecapMissing()}
	        <a href="#" popover-hover
            data-html="true"
            data-content="${('Il database non è sincronizzato. Possibile causa, malfunzionamento durante la procedura notturna di chiusura giorno. Questo problema si risolverà automaticamente non appena perverranno nuove timbrature.').escape()}"
            *{ title="Configurazione ${person.value.fullname}" }*><i class="fa fa-exclamation-triangle text-muted"></i></a>
        #{/elseif}
        
      <td><font color="#000000">${person.value.number}</font></td>
      <td data-order="${person.currentContract.get().beginDate}"><font color="#000000">${person.currentContract.get().beginDate?.format()}</font>
      </td>
      <td data-order="${person.currentContract.get().endDate}"><font color="#000000">${person.currentContract.get().endDate?.format()}</font>
      </td>

      <td>
        #{if person.currentWorkingTimeType.present}
        <a href="@{Persons.showCurrentContractWorkingTimeType(person.value.id)}"
           data-async-modal="#defaultModal">
          ${person.currentWorkingTimeType.get().description}
        </a>
        #{/if}
      </td>

      <td>
        #{if person.currentVacationPeriod.present }
        <a href="@{Persons.showCurrentVacation(person.value.id)}" data-async-modal="#defaultModal">
          ${person.currentVacationPeriod.get().vacationCode.label()}
        </a>
        #{/if}
      </td>

      <td><font color="#000000">${person.value.getQualification() != null ?
        person.value.getQualification().qualification : ''}</font></td>
      <td>
        ${person.value.office.name}
      </td>

      <!-- Invio email -->
      <td>
        #{if person.value.wantEmail}
        <i class="fa fa-check-square-o"></i>
        #{/if}
      </td>
      #{if switchUser}
      <td>
        <a class="btn btn-warning btn-xs"
           href="@{Administration.switchUserToPersonUser(person.value.id)}">Assumi identità</a>
      </td>
      #{/if}
    </tr>
    #{/if}


    #{/list}
    </tbody>
  </table>

  #{/tabContentItem}

  #{tabContentItem id:'nonAttivo'}

  <br>
  <table class="table table-striped table-hover table-condensed center" width="100%" datatable>
    <thead>
    <tr>
      <th>&{'person.name'}</th>
      <th>&{'person.number'}</th>
      <th>&{'person.qualification'}</th>
      <th>&{'user.username'}</th>
      <th>&{'person.email'}</th>
      #{if switchUser}
      <th></th>
      #{/if}
    </tr>
    </thead>
    <tbody>
    #{list items:personList, as:'person'}
    #{if person.currentContract.present}
    #{/if}
    #{else}
    <tr>
      <td class="personName alignLeft"><a href="@{edit(person.value.id)}"><font color="#808080">${person.value.fullname}</font></a>
      </td>
      <td><font color="#808080">${person.value.number}</font></td>
      <td><font color="#808080">${person.value.getQualification() != null ?
        person.value.getQualification().qualification : ''}</font></td>
      <td class="alignLeft">${person.value.user.username}</td>
      <td><font color="#808080">${person.value.email}</font></td>
      #{if switchUser}
      <td>
        <a class="btn btn-warning btn-xs"
           href="@{Administration.switchUserToPersonUser(person.value.id)}">Assumi identità</a>
      </td>
      #{/if}
    </tr>
    #{/else}
    #{/list}
    </tbody>
  </table>

  #{/tabContentItem}

  #{/tabContent}

</div>
