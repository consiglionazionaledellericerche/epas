#{extends 'main3.html' /}
#{set header:'navbar' /}
#{set title: 'ePAS - Modifica ' + person.name + ' ' + person.surname /}

#{set 'moreStyles'}
<style>
  .panel {
  	margin-top: 20px;
  }
  
  #table-list-contract {
  	margin-top: 30px;
  	margin-bottom: 10px;
  
  }
 
</style>
#{/set}

<ul class="nav nav-tabs">
  <li class="active"><a href="@{Persons.edit(person.id)}#">Dati Anagrafici ${person.name} ${person.surname}</a></li>
  <li><a href="@{Persons.insertChild(person.id)}#">Inserisci figlio per ${person.name} ${person.surname}</a></li>
</ul>

<div class="container">		<!-- Container dati personali e di contatto -->

#{form @Persons.update() }
<input type="hidden" name="person.id" value="${person.id}"/>

<!-- Pannello 1 Dati personali -->
<div class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title"><span class="badge">1</span> Dati Personali</h3>
  </div>
  <div class="panel-body">
    

    <table class="table table-condensed table-form table-hover">
		<tr>
			<td class="lab"><b>Cognome</b></td>
			<td><input name="person.surname" type="text" value="${person.surname}"/></td>
		</tr>
		<tr>
			<td class="lab"><b>Nome</b></td> 
			<td><input name="person.name" type="text" value="${person.name}"/></td>
		</tr>
		<!-- 
		<tr>
			<td class="lab">Id univoco</td> 
			<td><input name="daeliminare" type="text" value="${person.id}" disabled="disabled" /></td>
		</tr>
		 -->
		<tr>
			<td class="lab">Matricola</td> 
			<td><input name="person.number" type="number" value="${person.number}"/></td>
		</tr>
		<tr>
			<td class="lab">Numbero badge</td>
			<td><input name="person.badgeNumber" type="number" value="${person.badgeNumber}"/></td>
		</tr>
		<tr>
			<td class="lab"> Livello </td>
			<td>
			#{if person.qualification != null}
				#{select 'qualification', value:person.qualification.qualification, class:'span1', id:'withoutborder'} 
				#{option null}Seleziona la qualifica#{/option}
				#{option 1}1#{/option} #{option 2}2#{/option} #{option 3}3#{/option}
				#{option 4}4#{/option} #{option 5}5#{/option} #{option 6}6#{/option}
				#{option 7}7#{/option} #{option 8}8#{/option} #{/select}</div>
			#{/if}
			#{else}
				#{select 'qualification', value:'', class:'span1',id:'withoutborder'} 
				#{option null}Seleziona la qualifica#{/option}
				#{option 1}1#{/option} #{option 2}2#{/option} #{option 3}3#{/option}
				#{option 4}4#{/option} #{option 5}5#{/option} #{option 6}6#{/option}
				#{option 7}7#{/option} #{option 8}8#{/option} #{/select} 
		
			#{/else}
			</td>
		</tr>
		<tr>
			<td class="lab">Sede</td>
			<td>
			    #{select 'office.id', value:person.office.id, id:'office'} 
					#{list items: officeList, as: 'office'}
						#{option office.id}${office.name}#{/option}
					#{/list}
			    #{/select}
			</td>
		</tr>
	
	
	</table>

  </div>
</div>  <!-- Fine pannello 1 -->



<!-- Pannello 2 Contatti -->
<div class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title"><span class="badge">2</span> Informazioni di ubicazione e contatti</h3>
  </div>
  <div class="panel-body">
	
    <table class="table table-condensed table-form table-hover">
		<tr>
			<td class="lab">Dipartimento</td>
			<td><input name="person.department" type="text" value="${person.department}"/></td>
		</tr>
		<tr>
			<td class="lab">Sede</td>
			<td><input name="person.headOffice" type="text" value="${person.headOffice}"/></td>
		</tr>
		<tr>
			<td class="lab">Stanza</td>
			<td><input name="person.room" type="text" value="${person.room}"/></td>
		</tr>
		<tr>
			<td class="lab">Telefono</td>
			#{if person.telephone != null || !person.telephone.equals('No phone number') }
				<td><input name="person.telephone" type="text" value="${person.telephone}"/></td>
			#{/if}
			#{else}
				<td><input name="person.telephone" type="text" value=""/></td>
			#{/else}
		</tr>
		<tr>
			<td class="lab">Email</td>
			<td><input name="person.email" type="email" value="${person.email}"/></td>
		</tr>
		<tr>
			<td class="lab">Data di nascita </td>
			#{if person.birthday != null }
				<td><input data-datepicker data-date-format="yyyy-mm-dd" name="person.birthday" type="text" value="${person.birthday}"/></td>
			#{/if}
			#{else}
				<td><input data-datepicker data-date-format="yyyy-mm-dd" name="person.birthday" type="text" value=""/></td>
			#{/else}
			
		</tr>
	</table>
  
  </div>
</div>	<!-- Fine pannello 2 -->

</div>

   <div class="container-fluid center">
      <input class="btn btn-primary" type="submit" value="Salva" />
   </div>
#{/form}

<div class="container">	<!-- Container dati contrattuali -->

<!-- Pannello 3 Dati contrattuali -->
<div class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title"><span class="badge">3</span> Dati Contrattuali</h3>
  </div>
  <div class="panel-body">
  	  
	  <table class="table table-hover center table-list-contract">
		<tr class="warning">
			<th>Data inizio contratto</th>
			<th>Data fine contratto</th>
			<th>Data terminazione<br>esperienza</th>
			<th>Orario<br>di lavoro</th>
			<th>Attestato presenza</th>
			<th>Modifica date</th>
			<th>Elimina contratto</th>
			<th>Inizializzazione<br>ePAS</th>
			
		</tr>
		
		#{list items:contractList, as:'contract'}
		
		<tr>
			<td>
			  <h4><span class="label label-default">${contract.beginContract}</span></h4>
			</td>
			
			<td>
			  <h4><span class="label label-default">${contract.expireContract}</span></h4>
			</td>
			
			<td>
			  <h4><span class="label label-default">${contract.endContract}</span></h4>
			</td>
			
			<td>
			  
			  #{list items:contract.contractWorkingTimeType, as:'wtt'}
			  
			    <a data-popover
	    		data-trigger="hover" data-toggle="popover" 
	    		data-placement="bottom"
	    		data-html="true"
	    		data-content="
	    		${(
	    		'Inizio Periodo: <strong>'+wtt.beginDate+'</strong>'+
	    		'<br>Fine Periodo: <strong>'+wtt.endDate+'</strong>'
	    		).escape()}"
	    		title="Periodo validità orario">
	    		
	    		  <h4><span class="label label-default">${wtt.workingTimeType.description}</span></h4>
	    		
	    		</a>
	    		
			  #{/list}
			  
			  <a href="@{Persons.updateContractWorkingTimeType(contract.id)}" data-modal=".my-modal"><i class="fa fa-pencil-square-o"></i> Modifica</a>
			</td>
			
			<td>
			  #{if contract.onCertificate == true}
				<i class="fa fa-check-square-o"></i>
			  #{/if}
			  #{else}
				<i class="fa fa-square-o"></i>
			  #{/else}
			</td>
			
			<td>
			  <a href="@{Persons.modifyContract(contract.id)}" data-modal=".my-modal"><i class="fa fa-pencil-square-o"></i> Modifica</a>
			</td>
			
			<td>
			  <a href="@{Persons.deleteContract(contract.id)}" data-modal=".my-modal"><input value="Elimina" class="btn btn-sm btn-danger" type="button"></a>
			</td>
			
			 <td class="span4" style="text-align: center;">
			 #{if contract.sourceDate!=null}
			     Situazione alla data
			     <strong class="text-error">${contract.sourceDate}</strong><br>
			   #{if contract.sourceRemainingMinutesLastYear>0 }
			     Residuo ${contract.sourceDate.getYear()-1} 
			     <strong class="text-error">${contract.sourceRemainingMinutesLastYear}</strong><br>
			   #{/if}
			   #{if contract.sourceRemainingMinutesCurrentYear>0}
			     Residuo ${contract.sourceDate.getYear()} 
			     <strong class="text-error">${contract.sourceRemainingMinutesCurrentYear}</strong><br>
			   #{/if}
			   #{if contract.sourceVacationLastYearUsed>0}
			     Ferie usate ${contract.sourceDate.getYear()-1}
			     <strong class="text-error">${contract.sourceVacationLastYearUsed}</strong><br>
			   #{/if}
			   #{if contract.sourceVacationCurrentYearUsed>0}
			     Ferie usate ${contract.sourceDate.getYear()} 
			     <strong class="text-error">${contract.sourceVacationCurrentYearUsed}</strong><br>
			   #{/if}
			   #{if contract.sourcePermissionUsed>0}
			     Permessi usati ${contract.sourceDate.getYear()} 
			     <strong class="text-error">${contract.sourcePermissionUsed}</strong><br>
			   #{/if}
			   #{if contract.sourceRecoveryDayUsed!=null && contract.sourceRecoveryDayUsed>0}
			     Riposi compensativi usati ${contract.sourceDate.getYear()} 
			     <strong class="text-error">${contract.sourceRecoveryDayUsed}</strong><br>
			   #{/if}
			   
			   <a class="btn btn-small" href="@{Persons.updateSourceContract(contract.id)}" data-modal=".my-modal">Modifica</a>
			
			 #{/if}
			 #{else}
			   <a class="btn btn-small" href="@{Persons.updateSourceContract(contract.id)}" data-modal=".my-modal">Definisci Inizializzazione</a>
			 #{/else}
			</td>
			
		</tr>
		#{/list}

	  </table>
	  
	  <p>
  	    <a href="@{Persons.insertContract('person.id':person.id)}" data-modal=".my-modal">
  	      <span class="glyphicon glyphicon-plus"></span> Inserisci un nuovo contratto per ${person.surname} ${person.name}
  	    </a>
  	  </p>
	
	  <!-- Per sviluppo render dati di importazione mysql
	  <table class="table table-condensed table-border span8">
	    <tr>
	      <th>Data Importazione da vecchio orologio</th>
	      <th>Monte ore inizio 2013</th>
	      <th>Ferie fatte dell'anno 2012</th>	  
	    </tr>
  
	    #{if initTime!=null }
	    <tr>
	      <td>${initTime.date}</td>
	      <td>${initTime.residualMinutesPastYear}</td>
	      <td>${initTime.vacationCurrentYearUsed}</td>
	    </tr>	  
	    #{/if}
	  </table>
	  
	   -->
    </div>
  </div>  <!-- Fine pannello dati contrattuli -->
  
  
  
  
   <!-- Pannello 4 Elimina -->
  <div class="panel panel-default">
    <div class="panel-heading">
      <h3 class="panel-title"><span class="badge">4</span> Eliminazione persona ePAS</h3>
    </div>
    <div class="panel-body center">
      <a href="@{Persons.deletePerson(person.id)}" data-modal=".my-modal">
  	    <button type="button" class="btn btn-danger">Elimina</button>
  	  </a>
   </div>
  </div>	<!-- Fine pannello 2 -->
  
  
 
</div>
  
  
 
  
  




<div class="pull-right">
  <a class="btn btn-danger" href="@{Administrators.switchUserTo(person.user.id)}">Assumi questa identità</a>
</div>






#{include '_myModal.html' /}



