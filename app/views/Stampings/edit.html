%{
Action = (stamping != null && stamping.persistent) ? 'Modifica' : 'Nuova'
}%
#{modalAsync id:'modalStamping',
title:(Action + ' timbratura del ' + date.format() + ' per ' + person.fullname)}

#{if stamping}
#{tabs}
#{tabItem id:'edit', title:'Modifica', active:true /}
#{tabItem id:'delete', title:'Elimina' /}
#{/tabs}
<br>
#{/if}

#{tabContent}

#{tabContentItem id:'edit', active:true}
<div id="stampingData">
  #{form action:@save(), method:'POST', autocomplete:false, 'data-async':'#page_content',
  class:'form form-horizontal', 'data-async-error':'#stampingData',
  'data-spinner':'#defaultSpinner'}

  #{if stamping?.persistent}
    #{alert color:'info',center:true}
      Modifica i dati della timbratura delle ore ${stamping.formattedHour()}
    #{/alert}
    <!-- storico ?? -->
  #{/if}
  #{else}
    #{alert color:'info',center:true}
     Inserisci i dati della nuova timbratura
    #{/alert}
  #{/else}

  #{f.hidden 'person.id', value:person.id /}
  #{f.hidden 'date', value:date.format() /}

  #{if stamping?.persistent}
    #{f.hidden 'stamping.id', value:stamping.id /}
  #{/if}

  #{f.input 'time', popover:'true', value:stamping?.formattedHour(), required:true/}
  #{f.radioEnum 'stamping.way', items:models.Stamping.WayType, required:true /}
  #{if !employee}
  	#{f.selectEnum 'stamping.stampType', items:models.enumerate.StampTypes.onlyActive() /}
  #{/if}
  #{else}
  	#{f.input 'stamping.stampType', value:models.enumerate.StampTypes.offSiteWorkingForEmployee().description, readonly:readonly /}
  #{/else}
  #{f.input 'stamping.note' /}

  #{b.buttons center:true}

  #{if stamping?.persistent}
    #{b.submit 'Aggiorna'/}
  #{/if}
  #{else}
    #{b.submit 'Inserisci'/}
  #{/else}

  #{/b.buttons}

  #{/form}

</div>
#{/tabContentItem}

#{tabContentItem id:'delete'}
#{if stamping?.persistent}
<form class="form-horizontal">
  #{f.view 'time', value:stamping.formattedHour()/}
  #{f.radioEnum 'stamping.way', items:models.Stamping.WayType, disabled:true /}
  #{list items:historyStamping, as:'state'}
    #{if state.typeIsAdd() }
      #{f.view 'Dipendente', value:stamping.personDay.person.fullname /}
      #{f.view 'Inserita il', value:state.formattedRevisionDate() /}
      #{f.view 'Inserita da', value:state.formattedOwner() /}
    #{/if}
  #{/list}
</form>
<div class="alert alert-danger center">
  E' possibile eliminare questa timbratura.<br>
  <a class="btn btn-danger" href=@{delete(stamping.id)}><i class="fa fa-trash"></i>Elimina</a>
</div>
#{/if}
#{/tabContentItem}

#{/tabContent}

#{/modalAsync}
