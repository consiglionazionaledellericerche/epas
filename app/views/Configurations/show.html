#{extends 'main.html' /}
#{set header:'navbar' /}
#{set title: 'ePAS - Parametri di configurazione' /}

<div class="container">
  
  %{
    if (paramCategory.equals(manager.configurations.EpasParam.EpasParamCategory.GENERAL)) {
      generalActive = true;
    }
    if (paramCategory.equals(manager.configurations.EpasParam.EpasParamCategory.YEARLY)) {
      yearlyActive = true;
    }
    if (paramCategory.equals(manager.configurations.EpasParam.EpasParamCategory.PERIODIC)) {
      periodicActive = true;
    }
    if (paramCategory.equals(manager.configurations.EpasParam.EpasParamCategory.AUTOCERTIFICATION)) {
      autocertificationActive = true;
    }
  }%
  
  #{title title:('Parametri configurazione ' + office.name), administration:true /}

  #{tabList}
  #{tabItem id:'GENERAL', title:'Generali', active:generalActive /}
  #{tabItem id:'YEARLY', title:'Annuali', active:yearlyActive /}
  #{tabItem id:'PERIODIC', title:'Periodici', active:periodicActive /}
  #{tabItem id:'AUTOCERTIFICATION', title:'Autocertificazioni', active:autocertificationActive /}
  #{/tabList}

  <br>

  #{tabContent}

  #{tabContentItem id:'GENERAL', active:generalActive}
  <div id="editGeneral">
    #{alert color:'info'}
    <p>Elenco dei parametri generali di configurazione per la sede
      <strong>${office.name}</strong> ed il loro valore.</p>
    #{/alert}

    <table class="table">
      <tr>
        <th>Parametro</th>
        <th>Valore</th>
      </tr>
      #{list generals, as:'conf'}
      <tr>
        <td>#{secure.link @Configurations.edit(conf.id), target: conf, 'data-async-modal':'#defaultModal'}
          &{conf.epasParam}#{/secure.link}
        </td>
        <td>${templateUtility.getObjectInConfiguration(conf.epasParam, conf.fieldValue).label()}</td>
      </tr>
      #{/list}
    </table>
  </div>
  #{/tabContentItem}

  #{tabContentItem id:'YEARLY', active:yearlyActive}
  <div id="editYearly">
    #{alert color:'info'}
    <p>Elenco dei parametri di configurazione a cadenza annuale per la sede
      <strong>${office.name}</strong> ed il loro valore attuale.</p>
    #{/alert}

    <table class="table">
      <tr>
        <th>Parametro</th>
        <th>Valore</th>
      </tr>
      #{list yearlies , as:'conf'}
      <tr>
        <td>#{secure.link @Configurations.edit(conf.id), 'data-async-modal':'#defaultModal'}
          &{conf.epasParam}#{/secure.link}
        </td>
        <td>${templateUtility.getObjectInConfiguration(conf.epasParam, conf.fieldValue).label()}</td>
      </tr>
      #{/list}
    </table>
  </div>
  #{/tabContentItem}

  #{tabContentItem id:'PERIODIC', active:periodicActive}
  <div id="editPeriodic">
    #{alert color:'info'}
    <p>Elenco dei parametri di configurazione a cadenza periodica per la sede
      <strong>${office.name}</strong>, il loro valore attuale ed il periodo di riferimento.</p>
    #{/alert}

    <table class="table">
      <tr>
        <th>Parametro</th>
        <th>Valore</th>
        <th>Dal</th>
        <th>Al</th>
      </tr>
      #{list periodics, as:'conf'}
      <tr>
        <td>#{secure.link @Configurations.edit(conf.id), 'data-async-modal':'#defaultModal'}
          &{conf.epasParam}#{/secure.link} 
          #{if conf.epasParam.equals(manager.configurations.EpasParam.WORK_INTERVAL_MISSION_DAY) && !date.isAfter(limitShow)}
           <p style="color:red;">New! <i class="fa fa-check"></i></p>
          #{/if}
        </td>
        <td>${templateUtility.getObjectInConfiguration(conf.epasParam, conf.fieldValue).label()}</td>
        <td>${conf.beginDate.format()}</td>
        <td>${conf.calculatedEnd()?.format()}</td>
      </tr>
      #{/list}
    </table>
  </div>
  #{/tabContentItem}

  #{tabContentItem id:'AUTOCERTIFICATION', active:autocertificationActive}
  <div id="editAutocertifications">
    #{alert color:'info'}
    Elenco dei parametri di configurazione per l'abilitazione delle Autocertificazioni per la sede
    <strong>${office.name}</strong> ed il loro valore.
    #{/alert}

    <table class="table">
      <tr>
        <th>Parametro</th>
        <th>Descrizione
        <th>Valore</th>
      </tr>
      #{list autocertifications, as:'conf'}
      <tr>
        <td>
          #{secure.link @Configurations.edit(conf.id), target: conf, display:'denied', 'data-async-modal':'#defaultModal'}
            &{conf.epasParam}
          #{/secure.link}
          <br>
        </td>
        <td>
        #{if messages.get('description.' + conf.epasParam)}
          
            &{'description.' + conf.epasParam}
          
        #{/if}
        </td>
        <td>${templateUtility.getObjectInConfiguration(conf.epasParam, conf.fieldValue).label()}</td>
      </tr>
      #{/list}
    </table>

    <div class="panel panel-default">
      <div class="panel-body">
        #{if autocert}

        <p><strong><em>&{'tr_autocertification.file'}</em></strong></p>
        #{secure.link @getAttachment(autocert.id)}
          <i class="fa fa-file-o" aria-hidden="true"></i> ${autocert.filename}
        #{/secure.link}

        #{secure.check 'Configurations.removeAttachment', target: autocert}
        <a class="label label-badge label-danger" href="@{removeAttachment(autocert.id)}" webui-popover-hover data-content="Rimuovi File">
          <i class="fa fa-trash"></i> &{'crud.delete'}
        </a>
        #{/secure.check}

        #{/if}

        #{else}
        #{alert color:'danger'}
        <i class="fa fa-exclamation-triangle" aria-hidden="true"></i>
        &{'tr_autocertification.alert'}
        #{/alert}

        #{form action:@uploadAttachment(), method:'POST', class:'form-horizontal', enctype:'multipart/form-data'}
        #{f.hidden 'officeId', value:office.id /}

        #{f.input 'file', type: 'file', onChange:'javascript:this.form.submit()' /}

        #{/form}
        #{/else}
      </div>
    </div>
  </div>
  #{/tabContentItem}

  #{/tabContent}

</div>