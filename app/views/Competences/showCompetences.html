#{extends 'main.html' /}
#{set header:'navbar' /}
#{set title: 'ePAS - Assegna competenze'  /}

<div class="container">
  #{title title:'Assegna competenze ' + templateUtility.monthName(compDto.month) + ' ' + compDto.year, color:'primary' /}

  #{include './_tabs.html' /}

  #{if servicesInitialized}
  #{alert color:'info'}
  <p>Per assengnare la competenza individuare il dipendente ed il tipo di competenza nella
    tabella sottostante e cliccare sul valore attualmente assegnato.
  <p>
  <p>I valori per le reperibilità sono espressi in <strong>giorni</strong>,
    quelli per straordinari e turni in <strong>ore</strong>.</p>
  #{/alert}
  #{/if}
  #{else}
  #{alert color:'danger'}
  <p>Nella lista delle competenze attive compare anche la reperibilità. Per permettere al sistema ePAS di effettuare i corretti controlli
  sui giorni disponibili per tale competenza, è necessario attivare i servizi per cui la reperibilità è stata richiesta cliccando <a href="@{activateServices(office.id)}">qui</a>
  <p>
  #{/alert}
  #{/else}
    <!-- form paginata --> 
    #{form action:@showCompetences(), class:'form-horizontal', method:'GET',
          'data-reload':'#results', autocomplete:'off'}
	<input type="hidden" name="year" value="${compDto.year}"/>
    <input type="hidden" name="month" value="${compDto.month}"/>
    <input type="hidden" name="officeId" value="${compDto.office.id}"/>

	#{f.selectModel 'competenceCode', label:'Codice', items:competenceCodeList,
    	value:wrCompetenceCode.value /}
    
    #{/form}

    <section id="results">

	   <table class="table" datatable>
      		<thead>
      		<tr>
        		<th>Nome e cognome</th>
        		<th>${wrCompetenceCode.value.description} ${wrCompetenceCode.value.code}</th>
      		</tr>
      		</thead>
      		<tbody>
      		#{list items:compDto.compList, as:'competence'}
      		<tr>
				<td>${competence.person.fullname}</td>
				<td>
				#{if competence.id == null}
          #{secure.link @Competences.insertCompetence(competence.person.id, competence.competenceCode.id, competence.month, competence.year), 'data-async-modal':'#modalCompetence'}
          <em>Inserisci</em>
          #{/secure.link}
				#{/if}
				#{else}
          #{secure.link @Competences.editCompetence(competence.id), 'data-async-modal':'#modalCompetence'}
            ${competence.valueApproved}
          #{/secure.link}
				#{/else}
				</td>
			</tr>
      		#{/list}
      		</tbody>
       </table>

  <br>
  <br>
  #{alert color:'warning'}
  Totale competenze <strong>${wrCompetenceCode.value.description} ${wrCompetenceCode.value.code}</strong>
    assegnate nel mese per <strong>${compDto.office.name}</strong>
  <a data-tooltip data-toggle="tooltip" data-placement="right"
     title="Per aggiornare questo valore ricaricare la pagina">
    <strong>${wrCompetenceCode.totalFromCompetenceCode(compDto.month, compDto.year, compDto.office.id)}</strong>
  </a>
  #{/alert}
  </section>
  
  #{title title:'Riepilogo Straordinari assegnati ' + compDto.year, color:'primary' /}

  #{alert color:'info'}
  <h4><strong>Riepilogo straordinari ${compDto.office.name}</strong></h4>

  <table class="table table-condensed">

    <tr>
          <td>
            Totale ore di straordinario pagate a ${templateUtility.monthName(compDto.month)} (S1+S2+S3)
          </td>
      <td><strong>${compDto.totaleOreStraordinarioMensile}</strong></td>
        </tr>
        <tr>
          <td>Totale ore di straordinario pagate nell'anno</td>
          <td><strong>${compDto.totaleOreStraordinarioAnnuale}</strong></td>
        </tr>
        <tr>
          <td>Totale monte ore nell'anno ${compDto.year}</td>
          <td><strong>${compDto.totaleMonteOre}</strong></td>
        </tr>
      </table>
  #{/alert}
</div> <!-- end container-fluid -->

<div id="modalCompetence" class="modal fade container" tabindex="-1"></div>
